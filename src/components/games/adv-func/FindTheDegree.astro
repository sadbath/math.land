---
import InteractiveShell from '../InteractiveShell.astro';
---

<InteractiveShell>
    <p class="interactive-instructions">
        Find the <strong>degree</strong> of the polynomial below.
    </p>

    <div class="interactive-problem">
        <code id="poly-display" class="expression-text"></code>
    </div>

    <div id="options-grid" class="interactive-option-grid">
        <!-- Buttons will be generated by script -->
    </div>

    <button id="check-btn" class="interactive-action-button">Check</button>

    <div id="feedback-section" class="interactive-feedback">
        <p id="feedback-title" class="feedback-title"></p>
        <p id="feedback-explanation" class="feedback-explanation"></p>
    </div>
</InteractiveShell>

<style>
    .expression-text {
        font-size: 1.75rem;
        font-weight: 600;
        color: #343a40;
        font-family: var(--font-mono);
    }
</style>

<script>
    const questions = [
        { expression: '4x² - 5x³ + 2', degree: 3, options: [2, 3, 4, 5] },
        { expression: 'x + 7', degree: 1, options: [0, 1, 2, 7] },
        { expression: '-9', degree: 0, options: [0, 1, -9, 9] },
        { expression: 'x⁵ - 3x + 10x²', degree: 5, options: [1, 2, 5, 10] },
        { expression: '6x⁴ - x³ + 2x⁵', degree: 5, options: [3, 4, 5, 6] },
    ];
    let currentQuestion;
    let selectedAnswer = null;

    const display = document.getElementById('poly-display');
    const optionsGrid = document.getElementById('options-grid');
    const checkBtn = document.getElementById('check-btn');
    const feedbackSection = document.getElementById('feedback-section');
    const feedbackTitle = document.getElementById('feedback-title');
    const feedbackExplanation = document.getElementById('feedback-explanation');

    function loadQuestion() {
        let newQuestion;
        do {
            newQuestion = questions[Math.floor(Math.random() * questions.length)];
        } while (newQuestion === currentQuestion);
        currentQuestion = newQuestion;

        display.textContent = currentQuestion.expression;
        optionsGrid.innerHTML = ''; // Clear old options

        currentQuestion.options.forEach(option => {
            const button = document.createElement('button');
            button.className = 'interactive-button';
            button.textContent = option;
            button.dataset.value = option;
            button.addEventListener('click', () => {
                // Deselect others and select this one
                document.querySelectorAll('#options-grid .interactive-button').forEach(btn => btn.classList.remove('selected'));
                button.classList.add('selected');
                selectedAnswer = parseInt(button.dataset.value);
            });
            optionsGrid.appendChild(button);
        });

        feedbackSection.classList.remove('visible');
        checkBtn.textContent = 'Check';
        checkBtn.classList.remove('continue');
        selectedAnswer = null;
    }

    function checkAnswer() {
        if (selectedAnswer === null) return;

        const isCorrect = selectedAnswer === currentQuestion.degree;
        feedbackSection.classList.remove('correct', 'incorrect');
        feedbackTitle.classList.remove('correct', 'incorrect');

        if (isCorrect) {
            feedbackSection.classList.add('correct');
            feedbackTitle.classList.add('correct');
            feedbackTitle.textContent = 'Correct!';
            feedbackExplanation.textContent = `The degree is the single highest exponent, which is ${currentQuestion.degree}.`;
        } else {
            feedbackSection.classList.add('incorrect');
            feedbackTitle.classList.add('incorrect');
            feedbackTitle.textContent = 'Not quite!';
            feedbackExplanation.textContent = 'Remember, the degree is the largest exponent on any variable.';
        }
        feedbackSection.classList.add('visible');
        checkBtn.textContent = 'Continue';
        checkBtn.classList.add('continue');
    }

    checkBtn.addEventListener('click', () => {
        if (checkBtn.textContent === 'Continue') {
            loadQuestion();
        } else {
            checkAnswer();
        }
    });

    loadQuestion();
</script>